CD = cd
MKDIR = mkdir -p
CP = cp

# we use config.pri as a dependent to trigger rebuild of things when configure changes
CONFIG_PRI = @abs_srcdir@/config.pri
SYS_DATA_DIR = /usr/local/share/pdp++-@PL_LIB_VER@

all: qmake build

#TODO: should make sure qmake is run, although default for "all" is to run it
build: 
	@echo " "
	@echo "** Doing ($@) in all plugin directories**"
	@echo " "
	@for i in tacss/* ;\
	do \
	  if [ -d $$i ] ;\
	  then \
	    echo $$i; \
	    $(CD) $$i;\
	    if [ -f "NOBUILD" ]; then continue; fi; \
	    if ( $(MAKE); ) then echo "* Successfully ran $@ in $$i";\
	    else echo "*** Could not make $@ in $$i"; fi;\
	    $(CD) ../../;\
	  fi; \
	done
	@for i in pdp/* ;\
	do \
	  if [ -d $$i ] ;\
	  then \
	    echo $$i; \
	    $(CD) $$i;\
	    if [ -f "NOBUILD" ]; then continue; fi; \
	    if ( $(MAKE); ) then echo "* Successfully ran $@ in $$i";\
	    else echo "*** Could not make $@ in $$i"; fi;\
	    $(CD) ../../;\
	  fi; \
	done
	@echo " "
	@echo "** Make $@ successfully completed! **"
	@echo " "

# note: clean does not check the NOBUILD guy, on purpose
clean: 
	@echo " "
	@echo "** Doing ($@) in all plugin directories**"
	@echo " "
	@for i in tacss/* ;\
	do \
	  if [ -d $$i ] ;\
	  then \
	    echo $$i; \
	    $(CD) $$i;\
	    if ( $(MAKE) $@; ) then echo "* Successfully made $@ in $$i";\
	    else echo "*** Could not make $@ in $$i"; fi;\
	    $(CD) ../../;\
	  fi; \
	done
	@for i in pdp/* ;\
	do \
	  if [ -d $$i ] ;\
	  then \
	    echo $$i; \
	    $(CD) $$i;\
	    if ( $(MAKE) $@; ) then echo "* Successfully made $@ in $$i";\
	    else  echo "*** Could not make $@ in $$i"; fi;\
	    $(CD) ../../;\
	  fi; \
	done
	@echo " "
	@echo "** Make $@ successfully completed! **"
	@echo " "

qmake: 
	@echo " "
	@echo "** Doing ($@) in all plugin directories**"
	@echo " "
	@for i in tacss/* ;\
	do \
	  if [ -d $$i ] ;\
	  then \
	    echo $$i; \
	    $(CD) $$i;\
	    if [ -f "NOBUILD" ]; then continue; fi; \
	    if ( qmake; ) then echo "* Successfully ran $@ in $$i";\
	    else echo "*** Could not make $@ in $$i"; fi;\
	    $(CD) ../../;\
	  fi; \
	done
	@for i in pdp/* ;\
	do \
	  if [ -d $$i ] ;\
	  then \
	    echo $$i; \
	    $(CD) $$i;\
	    if [ -f "NOBUILD" ]; then continue; fi; \
	    if ( qmake; ) then echo "* Successfully ran $@ in $$i";\
	    else echo "*** Could not make $@ in $$i"; fi;\
	    $(CD) ../../;\
	  fi; \
	done
	@echo " "
	@echo "** Make $@ successfully completed! **"
	@echo " "

install: 
	@echo " "
	@echo "** Doing ($@) in all plugin directories**"
	@echo " "
	$(MKDIR) $(SYS_DATA_DIR)/lib
	$(CP) -Ru ../lib/plugins_pdp  $(SYS_DATA_DIR)/lib
	$(CP) -Ru ../lib/plugins_tacss  $(SYS_DATA_DIR)/lib
	@echo " "
	@echo "** Make $@ successfully completed! **"
	@echo " "

dist:
 


 
