#!/bin/sh -f

# NOTE: this is a simple script wrapper around the cmake command line tools, for
# those used to the autotools configure script conventions
# also, cmake has rather lame command-line args so this is generally quite useful
# for the lazy typers as well.

echo "Running simple configure script wrapper around cmake build system!"
echo "args are:"
echo "  --enable-debug (or --debug)  enable debug, non-optimized build"
echo "  --prefix=<path>              set the install prefix to path"
echo "  --enable-mpi (or --mpi)      enable MPI distributed memory parallel build"
echo "  (note: -- before args is optional, and - works too!)"
echo " "

cmake_cmd="cmake ../"
build_dir="build"

while [ $# -gt 0 ]
do
  preq=${1%=*}			# get part before =
  case $preq
  in
    --debug | --enable-debug | debug | enable-debug | -debug | -enable-debug)
      debug=true
      cmake_cmd="$cmake_cmd -DCMAKE_BUILD_TYPE=Debug"
      build_dir="build_dbg"
      shift 1
    ;;
    --prefix | -prefix | prefix)
      prefix=${1##*=}		# get part after =
      cmake_cmd="$cmake_cmd -DCMAKE_INSTALL_PREFIX=$prefix"
      shift 1
    ;;

    --enable-mpi | --mpi | mpi | enable-mpi | -mpi | -enable-mpi)
      mpi=true
      cmake_cmd="$cmake_cmd -DMPI_BUILD=true"
      shift 1
    ;;

    *)
      echo "Invalid argument -- please see above list"
      shift 1
    ;;
  esac
done

echo "configure script settings:"
echo "  debug:  $debug"
echo "  prefix: $prefix"
echo "  mpi:    $mpi"
echo " "
echo "  cmake command: $cmake_cmd"
echo " "

mkdir $build_dir
cd $build_dir
$cmake_cmd

