** Settings ***

Library          Telnet
Library          HttpLibrary.HTTP
Library          Process
Library          OperatingSystem

Resource         Server_lib.txt

Suite Setup      Initialize Emergent    ./test-projects/TestRemoveRows.proj
Suite Teardown   Shutdown Emergent

*** Variables ***

# use 'pybot -v debug:true server.txt' on the command line to
#      output the transmissions to/from Emergent using warnings
${debug} =       false

*** Test Cases ***

# Ideas on things to test
#  - SetDataTableCell and Matrix Cell

#
# Initialization and general tests
#

Initialize
    Set Suite Variable     ${verbose}       ${false}
    Run Keyword If         '${debug}' == 'true'       Set Suite Variable   ${verbose}  ${true}

Connection
    Sleep                  1 sec
    ${output} =            Read
    Print                  ${output}
    Should Contain         ${output}    Emergent Server v7.

RemoveData Rows
    Ensure Emergent Free
    Run Emergent Program	RestoreSomeTable
    ${output} =                  Run Command Wait      {"command": "RemoveData", "table": "SomeTable", "row_from": 5, "rows": 2}
    Status OK No Result          ${output}
    ${output} =                  Run Command Wait      {"command": "GetData", "table": "SomeTable"}
    Status OK Has Result         ${output}
    Column Value Should Match    ${output}      4      one    4
    Column Value Should Match    ${output}      5      one    7
    Column Value Should Match    ${output}      7      one    9
    Json Value Should Not Exist	 ${output}	/result/columns/8/values/0

    Run Emergent Program	RestoreSomeTable
    ${output} =                  Run Command Wait      {"command": "RemoveData", "table": "SomeTable", "row_from": -1, "rows": 1}
    Status OK No Result          ${output}
    ${output} =                  Run Command Wait      {"command": "GetData", "table": "SomeTable"}
    Status OK Has Result         ${output}
    Column Value Should Match    ${output}      0      one    0
    Column Value Should Match    ${output}      8      one    8
    Json Value Should Not Exist	 ${output}	/result/columns/9/values/0

    Run Emergent Program	RestoreSomeTable
    ${output} =                  Run Command Wait      {"command": "RemoveData", "table": "SomeTable", "row_from": -1, "rows": -1}
    Status OK No Result          ${output}
    ${output} =                  Run Command Wait      {"command": "GetData", "table": "SomeTable"}
    Status OK Has Result         ${output}
    Column Value Should Match    ${output}      8      one    8
    Column Value Should Match    ${output}      0      one    0
    Json Value Should Not Exist	 ${output}	/result/columns/9/values/0

    Run Emergent Program	RestoreSomeTable
    ${output} =                  Run Command Wait      {"command": "RemoveData", "table": "SomeTable", "row_from": -2, "rows": 1}
    Status OK No Result          ${output}
    ${output} =                  Run Command Wait      {"command": "GetData", "table": "SomeTable"}
    Status OK Has Result         ${output}
    Column Value Should Match    ${output}      8      one    9
    Column Value Should Match    ${output}      7      one    7
    Column Value Should Match    ${output}      0      one    0
    Json Value Should Not Exist	 ${output}	/result/columns/9/values/0

    Run Emergent Program	RestoreSomeTable
    ${output} =                  Run Command Wait      {"command": "RemoveData", "table": "SomeTable", "row_from": -2, "rows": 2}
    Status OK No Result          ${output}
    ${output} =                  Run Command Wait      {"command": "GetData", "table": "SomeTable"}
    Status OK Has Result         ${output}
    Column Value Should Match    ${output}      7      one    7
    Column Value Should Match    ${output}      0      one    0
    Json Value Should Not Exist	 ${output}	/result/columns/8/values/0

    Run Emergent Program	RestoreSomeTable
    ${output} =                  Run Command Wait      {"command": "RemoveData", "table": "SomeTable", "row_from": -2, "rows": -2}
    Status OK No Result          ${output}
    ${output} =                  Run Command Wait      {"command": "GetData", "table": "SomeTable"}
    Status OK Has Result         ${output}
    Column Value Should Match    ${output}      7      one    7
    Column Value Should Match    ${output}      0      one    0
    Json Value Should Not Exist	 ${output}	/result/columns/8/values/0

